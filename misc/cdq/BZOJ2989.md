要求历史版本的答案总和，相当于每次修改都增加一项。把这些项当作点放在平面直角坐标系中，则要求的 $|i-j|+|a_i-a_j|\leq k$ 的范围就是一个斜放的正方形。把坐标系旋转，即 $(x,y)\to(x-y,x+y)$，此时范围变为正放的正方形，做容斥加入询问序列统计答案即可。

时间复杂度 $\Theta(n+q\log^2(n+q))$。
