对于 Alice，考虑求出图以宝藏所在点开始搜索的一棵 bfs 生成树，由于原图是二分图，所以生成树上任意一条非树边只会连接深度差为 $1$ 的两个点。取一个数 $S$，若一条边的深度 $\leq S$，就令儿子向父亲连边，否则令二分图中的其中一部点向另外一部点连边。

对于 Bob，注意到只要能找到一个深度 $\leq S$ 的结点，就可以每次向唯一的出边走，直到没有出边了，那么这个点就是宝藏所在点。如何判断一个点深度是否 $\leq S$？注意到深度 $> S$ 的点要么只有入边，要么只有出边，于是只要遇到了既有入边又有出边的点，就可以确定它的深度 $\leq S$。

注意到对于一张图，如果存在深度 $> S$ 的点，就至少有 $\Theta(S)$ 个点的深度 $\leq S$，故期望随机 $O\left(\dfrac nS\right)$ 就可以找到一个深度 $\leq S$ 的点。

按照上述算法随机直到找到符合条件的点即可。取 $S=\sqrt n$ 即可通过此题，需要注意图的形态是菊花图时可能需要一些特殊处理。
