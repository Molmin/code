先考虑如何构造一个合法的序列。

注意到前缀和最大值是确定的，我们枚举整个序列的和，记初始序列为 $1,1,\cdots,1,-1,-1,\cdots,-1$，其中 $1$ 的个数等于前缀和的最大值，$-1$ 的个数要满足整个序列的和符合枚举值。

考虑从最大值遍历到最小值，对于一个值 $x$，若我们构造的序列（的前缀和）中这个值出现次数比输入的多，则显然不可能；若我们构造的少，就考虑插入若干个 $-1,1$ 使得它们变得一样。具体而言，我们要找到一个位置的前缀和是 $x$，在其后面插入 $-1,1$，此时插入的那个 $1$ 的前缀和也是 $x$，于是 $x$ 和 $x-1$ 的数量都增加了 $1$。

在这个构造过程可以计数。模拟上述构造过程，会发现每次遍历到一个值的时候，无论之前在哪里插入，这个值的出现次数固定，于是相当于要在前缀和是 $x$ 的若干个位置插入总数为确定值的 $-1,1$，容易用组合计数知识解决。

时间复杂度 $O(n^2)$。
