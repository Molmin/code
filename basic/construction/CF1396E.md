考虑可行构造的上下界。对于一条边，如果其两侧点数均为偶数，则最小可以经过 $0$ 次该边，如果两侧点数均为奇数，则最小可以经过 $1$ 次该边，最大均可以经过两侧较小的点数的次数。

显然，如果不在上述范围内或者奇偶性与上述不匹配说明一定无解。下面构造其他情况的解。

首先构造出一个距离和最大的解。每个点的深度固定，为了让距离和最大，只需让每个点对的 LCA 深度最小。不妨让 LCA 均为根结点，那么每次从根结点的子树中选出两个大小最大的子树的两个点配对删除，最后剩下一个点与根结点配对即可实现最大解。注意为了防止出现一棵子树的结点数超过总点数的一半，多余结点无法配对的情况，可以选择整棵树的重心作为根结点。

考虑怎么让距离和变小。只要让一个 LCA 变深 $d$ 个单位，答案就可以变小 $2d$。考虑找出一个深度最大的非叶子结点，删除它的两个儿子或者一个儿子和它自己，剩下的部分按照原方案配对即可实现答案变小 $2d$。但是答案可能会变得比目标还小，只需在这个时候让 LCA 往上跳父亲，找到一个我们需要的深度即可。

注意为了保证最后仍然不存在超过总点数一半的子树，每次调整 LCA 的时候要选择最大的那一棵子树操作。
