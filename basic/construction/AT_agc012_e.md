注意到第一种操作只可能走到一个给定点，走到一个给定点必然选择补满水。所以每次重置容积和拥有水量为当前水量的一半得到的新值是确定的。

所以不同的水量数量是 $\Theta(\log v)$ 的，不妨求出每个结点在这些水量状态下能走到的最左侧的结点和最右侧的结点。这样相当于形成了 $\Theta(\log v)$ 层，每层有若干线段。而一个结点开始能够遍历所有结点的充要条件就是在每层选一个线段使得这些线段覆盖所有结点。

显然当第一层段数大于 $k$ 时每层段数都大于 $k$，所以此时一定不能完成。

考虑状态压缩动态规划，先排除第一层的线段。记 $f(S)$ 表示在选用了集合 $S$ 的层的线段后能达到的最长的前缀，$g(S)$ 表示在选用了集合 $S$ 的层的线段后能达到的最长的后缀。

再枚举第一层的线段，判断是否能到达最左侧和最右侧即可。

时间复杂度 $\Theta((n+v)\log v)$。
